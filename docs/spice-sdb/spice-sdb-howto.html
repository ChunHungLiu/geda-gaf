<html>

<head>
<title>
gEDA-SPICE-HOWTO
</title>
</head>

<body lang=EN-US style='tab-interval:.5in;text-justify-trim:punctuation'>

<center>
<h1><p>SPICE on gEDA HOWTO</p></h1>
</center>

<p>
<ul>
<li>Revision 1.0 – 3.10.2003, SDB.</li>
<li>Revision 1.1 – 3.19.2003.  Added .SUBCKT stuff & stuff about LTSpice.  SDB.</li>
<li>Revision 1.2 – 3.31.2003.  Added stuff about creating hierarchical
projects (i.e. creating .SUBCKTs using gschem and incorporating a
lower level .SUBCKT into a higher level schematic).</li>
</ul>
</p>

<p>The most recent copy of this document is always available at
http://www.brorson.com/gEDA/SPICE/</p>

<h1>Introduction</h1>

<p>The purpose of this document is to explain how to use the
gEDA tools (running on Linux) to perform SPICE simulations.  
In particular, this HOWTO documents the
usage of spice-sdb.scm, which is an advanced Scheme backend for the SPICE
netlister (gnetlist).  I assume that you
are already familiar with electronic design, the mechanics of schematic capture
using EDA tools, and SPICE simulation in general.
I also assume that you are reasonably familiar with the Linux
operating system and its development environment.</p>

<h2>Overview</h2>

<p>From the top level, spice simulation in gEDA proceeds via
the following steps:</p>

<ol>
 <li>Creation and gathering of schematic symbols and SPICE model files.
Oftentimes, the SPICE model files are obtained from the component vendor.</li>
<li>Schematic capture using symbols and SPICE models created in step 1.</li>
<li>Netlist generation from the schematic created in step 2.</li>
<li>SPICE simulation of the circuit described by the netlist created in step 3.</li>
</ol>

<p>To create a spice netlist, the netlister (gnetlist) iterates
through the entire schematic and looks at several parts of each component's
symbol in order to create a blob of spice code.
In general, each component can generate one or more lines of
spice code.  Component information read
by the netlister is held in two places:</p>

<p>
<ul>
<li>The symbol itself, in the &quot;device&quot; attribute,
which is attached when the symbol is created, and is typically accessed through
the symbol editor.
<li>In attributes manually attached to the component during
schematic capture using gschem.
</ul>
<p>


<p>Since there are two places the netlister looks for
information, you must make sure that the required information is available in
both places. </p>

<h2>SPICE netlister configuration </h2>

<p>This document was written around gEDA/gaf 20030223, and the
SPICE netlister spice-sdb.
Other
versions of gEDA work similarly to that described below.
However, only the spice-sdb netlister will
work as described below.
Therefore,
make sure that you have installed spice-sdb.scm in your scheme directory
(usually ${prefix}/geda/share/gEDA/scheme)
If you don't have it, spice-sdb is available
for download under</p>

<a href="http://www.brorson.com/gEDA/SPICE/gnet-spice-SDB.SCM">
http://www.brorson.com/gEDA/SPICE/gnet-spice-SDB.SCM
</a>

<p>
As of 20030427, spice-sdb is part of the gEDA/gaf distribution and should work
out of the box.  When this backend was integrated into the release, it was
renamed to gnet-spice-sdb.scm (AVH 04/27/2003).

<h2>Design/simulation flow summary</h2>

<p>The design flow used for SPICE simulation is:

<ol>

<li>
Schematic
symbol creation with correct &quot;device&quot; attribute.
(Usually, the symbols are already created with the correct
&quot;device&quot; attribute.)
</li>

<li>
Schematic capture using gschem.
</li>

<li>
Assignment of SPICE attributes (value, model, file, type, etc.) using gschem.
</li>

<li>
Assignment of refdes using e.g. refdes_renum.
</li>

<li>
Creation of netlist using gnetlist.
</li>

<li>
Check netlist for correctness (manually open and inspect netlist).
</li>

<li>
Run spice using a simulator such as LTSpice or ngspice.
</li>

<li>
Plot/analyze results (often plotting/analysis tools are incorporated in the simulator).
</li>

</ol>

<h1>Symbol and SPICE file configuration</h1>

<h2>Symbol creation for SPICE netlisting.</h2>

<p>The SPICE netlister recognizes a particular symbol in two ways:  
1.  The symbol's &quot;device&quot; attribute, and 
2.  The symbol's  refdes.
Both of these attributes are attached to the symbol when the symbol is created.</p>

<p>Each symbol has a &quot;device&quot; attribute attached to
it.  The &quot;device&quot; attribute is the first
thing the netlister examines when processing the symbol.
There are a number of devices which are
native to the netlister, meaning that the netlister knows exactly how to deal
with these types of devices.
Native
device types include RESISTOR, CAPACTIOR, NPN_TRANSISTOR, etc.
The entire list of native devices is present
in the appendix.

<p>The &quot;device&quot; attribute is hidden during normal use
of gschem.
Most often, the symbol's
creator has already given the symbol the correct &quot;device&quot;
attribute.
However, because the
&quot;device&quot; attribute is hidden from the ordinary user, it can sometimes
cause problems with SPICE netlist creation when it is set to an unexpected
value.
To view the &quot;device&quot;
attribute, go into the symbol editor (select the symbol to edit, and do
&quot;Hierarchy&quot; -&gt; &quot;down symbol&quot;), and turn on invisible
attributes (Edit -&gt; show/hide inv text).
If the &quot;device&quot; attribute is incorrect, you may change it by editing the
symbol itself using a text editor.

<p>If a symbol is not native (i.e. the netlister doesn't
recognize it as a built-in type), the netlister relies upon the first letter of
the refdes to determine how to process the symbol.
The refdes prefix is also built into the symbol when it is
created.
Example refdes prefixes are R
for resistors, C for capacitors, Q for transistors, etc.
Refdes prefixes correct for SPICE are listed
in the appendix.
Note that relying upon
the refdes to identify the component for SPICE is not foolproof -- for example,
the netlister cannot distinguish between NPN and PNP transistors based upon the
refdes.
Therefore, it is always best to
use a native &quot;device&quot; in your symbols.</p>

<h2>SPICE file configuration</h2>

<p>Files holding complicated SPICE models or other SPICE code
may be incorporated into the final SPICE netlist by including appropriate
symbols into the schematic.
SPICE model
files are usually obtained from component vendors.
Dealing with these files is straightforward.
However, some issues should be kept in mind
when preparing models for use during schematic capture:</p>

<ul style='margin-top:0in' type=disc>
 <li>It
     is usually prudent to place these files into a dedicated directory
     distinct from the symbol directories.</li>
 <li>Make
     sure that the SPICE files pin assignments correctly correspond to the pins
     as defined in the component's symbol.</li>
 <li>Make
     sure that the last character in a SPICE model file is a carriage
     return.  If no carriage return
     exists, then the next component listed in the netlist may be placed on the
     same line as the last line of the SPICE model file.</li>
</ul>

<h1>Schematic capture</h1>

<h2>Gschem attributes for spice netlisting</h2>

<p>There are several ways that spice attributes may be
associated with a component using gschem.
The way you choose to do this depends upon many factors, including the
type of component, and the size and format of the SPICE model.</p>

<h3>Component attributes and meanings</h3>

<p>The following attributes are meaningful for SPICE
netlisting, and may be attached from within gschem:</p>

<ul>

<li>
<b>refdes:</b> 
The reference designator of the component.
Valid values depend upon the component type and are given in the
appendix.
</li>

<li>
<b>value:</b>
For passives, this is the component value.
For actives, this is the type (model no) of the component (e.g.
2N3904, uA741).
When a model for an
active is instantiated separately from the component itself, the
&quot;value&quot; attribute holds the name of the spice model.
</li>

<li>
<b>model:</b>
This holds a one line spice model for the component.
</li>

<li>
<b>file:</b>
This holds the name of a file.
Typically, this is a file holding e.g. a SPICE .MODEL, .SUBCKT, or
other SPICE code.
</li>

<li>
<b>model-name:</b>
This holds the name of the spice model referred to in a .MODEL or .SUBCKT
statement.
&quot;model-name&quot; is
mainly used to identify the spice model name in the symbol &quot;spice-model-1.sym&quot;.
Active components should call out this name
in the &quot;device&quot; attribute to associate the component with its
particular spice model or subcircuit.
</li>

<li>
<b>type:</b>
This specifies the type of component 
and is used by spice when interpreting the model parameters.
Valid values depend upon the device being
modeled.
</li>
</ul>

<h3>Refdes conventions</h3>

<p>As a prerequisite to handling SPICE-related attributes, the
SPICE netlister requires that all components must have a refdes attached to
them.  The refdes may be attached either
by hand (which is laborious), or using the program refdes_renum included in the
gEDA distribution.

<p>Note that the first letter of the refdes must correspond to
the appropriate letter for spice simulation.
The refdes convention is given in the appendix</p>

<h3>Passives</h3>

<h4>
Basic passives
</h4>

<p>The most basic components which one encounters in spice are
passive components like resistors and capacitors which have numeric values, but
no other modeling attributes.  In this
case the following attributes must be filled in:

<ul>
<li>
<b>refdes:</b>
The correct refdes for the component.
</li>

<li>
<b>value:</b>
For passives, this is the numeric value of the component (e.g. 100pF).
For actives, this attribute may be filled
in, but if no model attribute is available elsewhere in the schematic, the
value is not used (in SPICE netlisting, anyway).
</li>
</ul>

<p>If only a refdes and value attribute are encountered, the
netlister will write a single line into the output file.</p>

<blockquote>
<p>
<b>Example resistor:</b><br>
refdes = R2<br>
value = 220<br>
SPICE line generated: R2 0 4 220
</p>
</blockquote>

<p>(note that &quot;0&quot; and &quot;4&quot; correspond to the
net nodes connected to the component, and are generated automatically by
gnetlist.)</p>

<blockquote>
<p><b>Example capacitor:</b><br>
refdes = C22<br>
value = 1UF<br>
SPICE line generated: C22 4 23
1UF</p>
</blockquote>

<h4>Passives with additional attributes</h4>

<p>Oftentimes, passive components have additional attributes
attached to them for spice simulation.
Examples of such attributes are temperature coefficients (for resistors)
and initial conditions (for reactive components).
These additional components may be incorporated into the SPICE
file by simply attaching them to the component's &quot;model&quot; attribute.
Specifically, the required attributes are:</p>

<ul>

<li>
<b>refdes:</b>
Correct component refdes.
</li>

<li>
<b>value:</b>
Numerical component value, as always.
</li>

<li>
<b>model:</b> 
One line string holding additional parameters,
formatted as a valid SPICE string.
</li>

</ul>

<p>This string is placed after the component value in the line
generated by gnetlist.
Therefore, it is
important to format the string placed in the &quot;model&quot; line to be valid SPICE
code.
Otherwise, you will risk causing
the SPICE simulator to barf.</p>

<blockquote>
<p><b>Example resistor:</b><br>
refdes = R5<br>
value = 1MEG<br>
model = TC=0.001,0.015<br>
SPICE line generated: R2 0 4 220 TC=0.001,0.015
</p>
</blockquote>

<h3>Transistors and diodes</h3>

<p>Transistors and diodes are generally accompanied by a
device-specific model -- otherwise, SPICE simulation is pointless.
The SPICE model may be either a short,
one-line string of parameters, or a multi-line set of SPICE parameters.
A typical one-line parameter string is a
short list of parameters describing a small-signal diode.
Typical multi-line models come from
component vendors, who often provide models for their components in a text
file.
Since there are two broad formats
of SPICE information, there are two approaches to incorporating these
parameters into the schematic:</p>

<h4>One line string of SPICE parameters</h4>

<p>To incorporate a one line string of SPICE parameters into
the netlist, the following attributes must be attached to the component:</p>

<ul>

<li>
<b>refdes:</b>
Correct component refdes.
</li>

<li>
<b>value:</b>
The model number or part number of the component.
</li>

<li>
<b>model-name:</b>
The name you wish to give the SPICE
model.
This is usually the model number
or part number of the component.
If you
have already attached a &quot;value&quot; attribute to the component, this parameter is
optional.
</li>

<li>
<b>model:</b>
One line string holding additional
parameters.
Do not place the model
parameters in parentheses -- gnetlist will do this for you.
</li>
</ul>

<blockquote>
<b>Example diode:</b><br>
refdes = D5<br>
model-name = 1N1004<br>
model = IS=0.5UA RS=6 BV=5.20<br>
SPICE lines generated: <br>
D5 2 6 1N1004<br>
MODEL 1N1004 D (IS=0.5UA RS=6 BV=5.20)
</blockquote>

<h4>SPICE model file</h4>

<p>To incorporate a file-full of SPICE parameters into the
netlist, the following attributes must be attached to the component:</p>

<ul>
<li>
<b>refdes:</b>
Correct component refdes.
</li>

<li>
<b>value:</b>
The model number or part number of the component.
</li>

<li>
<b>model-name:</b>
the name you wish to give the SPICE
model.
This is usually the model number
or part number of the component.
If you
have already attached a &quot;value&quot attribute to the component, this parameter is
optional.
</li>

<li>
<b>file:</b>
The file
name of the SPICE model which you wish to incorporate into the netlist.
This file name may specify either a relative
or an absolute path, but it is probably better to use an absolute path to avoid
problems if you ever move your schematic directory.
</li>
</ul>

<p>Note that you need to make sure that the model name held in
your SPICE model file is the same as the &quot;value&quot; or &quot;model-name&quot; attributes you
attached to the component.It is also a
good idea to verify that the pin assignments in the model file correspond to
the pin assignments made by the component symbol.</p>

<h3>Actives -- integrated circuits</h3>

<p>Integrated circuits are incorporated into the netlist
similarly to transistors and diodes.
As
such, you may incorporate the spice information either as a one-line parameter
string, or as a model file.</p>

<h4>One line string of SPICE parameters</h4>

<p>To incorporate a one line string of SPICE parameters into
the netlist, the following attributes must be attached to the component:</p>

<ul>
<li>
<b>refdes:</b>
Correct component refdes.
</li>

<li>
<b>value:</b>
The model number or part number of the component.
</li>

<li>
<b>model-name:</b>
the name you wish to give the SPICE model.
This is usually the model number or part
number of the component.
If you have
already attached a &quot;value&quot; attribute to the component, this parameter is
optional.
</li>

<li>
<b>model:</b>
One line string holding additional
parameters.
Do not place the model
parameters in parentheses -- gnetlist will do this for you.
</li>
</ul>

<h4>SPICE .MODEL or .SUBCKT file</h4>

<p>To incorporate a file-full of SPICE parameters into the
netlist, the following attributes must be attached to the component:</p>

<ul>
<li>
<b>refdes:</b>
Correct component refdes.  <b>Note that if the file holds a .MODEL, the
refdes should start with U; if the file holds a .SUBCKT, the refdes
should start with X.</b>  The netlister checks for the file type and
tries to "do the right thing", but
problems can arise if you don't follow this rule. 
</li>

<li>
<b>value:</b>
The model number or part number of the component.
</li>

<li>
<b>model-name:</b>
The name you wish to give the SPICE
model.
This is usually the model number
or part number of the component.
If you
have already attached a &quot;value&quot; attribute to the component, this parameter is
optional.
</li>

<li>
<b>file:</b>
The 
name of the file holding the SPICE .MODEL or .SUBCKT which you wish 
to incorporate into the netlist. 
This file name may specify either a relative
or an absolute path, but it is probably better to use an absolute path to avoid
problems if you ever move your schematic directory.
</li>
</ul>

<p>Note that you need to make sure that the model name held in
your SPICE model file is the same as the &quot;value&quot; or &quot;model-name&quot; attributes you
attached to the component.
It is also a
good idea to verify that the pin assignments in the model file correspond to the
pin assignments made by the component symbol.</p>

<h3>Independent sources</h3>

<p>There are two independent sources: voltage sources and current sources.
For incorporation into a SPICE netlist, they both work the same
way. To incorporate an independent source into your SPICE netlist, do the
following:</p>

<ol>
<li>
Place the independent source on your schematic.
(Do &quot;Add&quot; -&gt;
&quot;Component&quot; -&gt; &quot;spice&quot; -&gt; &lt;independent source
name&gt;.sym&quot;)
</li>

<li>
Double click on the block and add/edit the following
attributes:

<ul>
<li><b>refdes:</b> V? or I?
</li>

<li>
<b>value:</b> A one
line string in SPICE format describing the source.
</li>
</ul>
</ol>

<h3>Dependent sources</h3>

<p>There are four dependent sources:</p>

<p>This section remains TBD.</p>

<h3>SPICE components</h3>

<h4>Spice model block</h4>

<p>In certain situations, you may wish to embed a spice model
block directly into your schematic.
This is done when you have several devices with a &quot;value&quot;
attribute calling out for a spice model.
Depending upon whether the spice block is one line or multi-line, you
may embed the code in one of two ways:</p>

<h5>One line SPICE model:</h5>

<ol>
<li>
Place a spice model block on your schematic.
(Do &quot;Add&quot; -&gt;
&quot;Component&quot; -&gt; &quot;spice&quot; -&gt; spice-model-1.sym&quot;)
</li>

<li>
Double click on the block and add/edit the following
attributes:
<ul>
<li>
<b>refdes:</b> a?
</li>

<li>
<b>model:</b>
model name (i.e. the model name used in the
components being modeled.)
</li>

<li>
<b>type:</b>
One of
the valid spice component types defined in the spice spec.
</li>

<li>
<b>value:</b>
The
corresponding one-line spice model
</li>
</ul>
</ol>

<h5>Multi-line SPICE model:</h5>

<ol>
<li>Place a spice model block on your schematic.(Do &quot;Add&quot; -&gt;
&quot;Component&quot; -&gt; &quot;spice&quot; -&gt; spice-model-1.sym&quot;)
</li>

<li>
Double click on the block and add/edit the following
attributes:

<ul>
<li>
<b>refdes:</b> a?
</li>

<li>
<b>model-name:</b> model name
</li>

<li>
<b>file:</b> Name of
file holding SPICE model code (i.e. .MODEL or .SUBCKT).
</li>
</ul>
</ol>

<h4>Include block</h4>

<p>The include block places a .INCLUDE directive into your
netlist.</p>

<ol>
<li>
Place a spice model block on your schematic.
(Do &quot;Add&quot; -&gt;
&quot;Component&quot; -&gt; &quot;spice&quot; -&gt; spice-include-1.sym&quot;)
</li>

<li>
Double click on the block and add/edit the following
attributes:

<ul>
<li>
<b>refdes:</b> a?
</li>

<li>
<b>file:</b> The name
of the file to include.
</li>
</ul>
</ol>

<h4>SPICE directive block</h4>

<p>Placing a SPICE directive block into your schematic creates
an arbitrary block of SPICE code in the netlist.
The directive may be either statements held in a file, or a
one-line string held in the &quot;model&quot; attribute.
Examples of situations where this is useful include:

<ul>
<li>
.TEMP statement
</li>

<li>
.IC statement
</li>


<li>
Other SPICE statements for which gschem has no symbol.
</li>
</ul>

<p>To place a SPICE directive on your schematic, do:</p>

<ol>
<li>
Place a SPICE directive block on your schematic.
(Do &quot;Add&quot; -&gt;
&quot;Component&quot; -&gt; &quot;spice&quot; -&gt; spice-directive-1.sym&quot;)
</li>

<li>
Double click on the block and add/edit the following
attributes:

<ul>
<li>
<b>refdes:</b> a?
</li>

<li>
<b>file:</b> The name
of the file to include.
</li>
</ul>
</ol>

<h2>Handling hierarchical models</h2>

<p>
In SPICE modeling, there are often situations where you wish to create
a schematic representation of some particular component as a .SUBCKT,
and then embed that component's model in a higher level schematic.
A common example might be as follows: You are doing a microwave
simulation, and want to use a capacitor 
model which includes parasitic inductances and resistances, as well
as the capacitance.  Capacitor manufacturers often supply a printed
schematic showing a circuit topology incorporating parasitics, and
specify values for the parasitics.  You would like to draw the
capacitor model using gschem, netlist it to create a .SUBCKT, and then
use the .SUBCKT to model capacitors in a higher lever schematic. 
</p>

<p>
Since this kind of task is very common in SPICE simulation,
gnet-spice-sdb now supports it (starting with rev 20030331).  To
create a lower level .SUBCKT and 
use it in a higher level schematic, do the following:
<ol>
<li>
Draw the schematic of the lower level component (e.g. the capacitor +
parasitics) using gschem.
</li>

<li>
On the lower level schematic, place a spice-subcircuit-LL block
(spice-subcircuit-LL-1.sym).  This 
alerts the netlister that the schematic is a Lower Level .SUBCKT.
Attach the following attributes to the symbol:
<ul>
<li>
model-name = cap_with_parasitics
</li>
</ul>
(Of course, "cap_with_parasitics" is the <i>example</i> we use here.  Use
your own model name in your schematic.)
Upon netlisting, this schematic symbol will cause the netlist to
insert ".SUBCKT cap_with_parasitics <nets>" into the first line of the
netlist file.  
</li>

<li>
On the lower level schematic, attach a 
spice-subcircuit-IO symbol (spice-subcircuit-IO-1.sym)
to each IO net (i.e. connection to the
upper level).  Number the refdeses of the
IO symbols in the same order as you would like the IO nets to be
listed in the .SUBCKT line in the output file.  (i.e. P1 = first, P2 =
second, etc.)
</li>

<li>
When you are done with the lower level schematic, netlist it in the
usual way.  For example, if your schematic is called
cap_with_parasitics.sch, netlist it by saying:<br>
gnetlist -g spice-sdb -o cap_with_parasitics.cir
cap_with_parasitics.sch<br>
This will dump the SPICE netlist into the file called
"cap_with_parasitics.cir".  Visually inspect the .cir file to make sure
that netlisting worked correctly.  
</li>

<li>
Next, create a symbol for the upper level schematic which will point
to the .SUBCKT.  Note that the symbol must have a refdes starting with
the letter "X".  To ensure that this happens, do the following:
<ol>
<li>
Use gschem to draw the symbol.  I usually draw a box around a model
symbol to distinguish it from a normal component.   Make any other
annotations desired.
</li>
<li>
In the symbol, make sure that the pins are ordered identically to the
order in which you have placed the pins in the .SUBCKT.  This is done
by editing the symbol with a text editor and setting the "PINSEQ"
attribute.  The netlister will output the pins in the order determined
by the "PINSEQ" attribute.
</li>
<li>
Using a text editor, give the symbol a "DEVICE" attribute like
"capacitor-model".  Do <b>not</b> assign the symbol one of the native device
types listed in the appendix!  The goal is to create a symbol whose
refdes starts with "X", and if the "DEVICE" is a recognized type, this
will not happen.
</li>
<li>
Using a text editor, give the symbol the "REFDES" attribute "X?"
</li>
</ol>
</li>

<li>
Create the upper level schematic.  Place your newly created symbol on
the schematic as many times as required & wire up
the schematic in the usual way.
</li>

<li>
To point your symbol to the lower level .SUBCKT, double click on the
symbol and set the following attributes:
<ul>
<li>
file = cap_with_parasitics.cir
</li>
<li>
model-name = cap_with_parasitics
</li>
</ul>
as well as any other attributes required (e.g. refdes). 
</li>

<li>
Now netlist your upper level schematic the usual way.  The contents of
each .SUBCKT file is dumped into the main netlist. Inspect your
netlist visually using a text editor to ensure that it is correct.
It is a good idea to pay particular attention to the following:
<ul>
<li>Verify that the ordering of the nets connecting the
upper level netlist to the lower level .SUBCKT is correct.</li>
<li>Make sure that the upper level model-name and the lower level
model name (on the .SUBCKT declaration line) are the same.
</li>
</ul>
</ol>
</p>

<p>
Once the netlist is created, you may simulate your design using any
SPICE simulator desired.
</p>

<p>
One final note:  The netlister writes the contents of the lower level
.SUBCKT file into the main netlist <b>every time</b> it encounters a
component with "FILE" attribute pointing to that file.   Therefore, if
you use the same component with the same model more than once in a
design you should instantiate the model file using a "spice-model"
symbol and point to it with each component.  This is described in the
"multi-line SPICE model block" section above.
</p>

<h1>SPICE netlist generation</h1>

<h2>Creating the netlist</h2>

<p>Creating a netlist from a schematic is easy.
To generate a SPICE netlist, just do the
following:</p>

<ul>
<li>
Save your schematic to &lt;filename.sch&gt;
</li>

<li>
Create the SPICE netlist by doing &quot;gnetlist -g spice-sdb &lt;filename.sch&gt;&quot;.
The output is a netlist held in the
file output.net.  Alternatively, if you wish to give your output file
a different name, set the output name using the -o switch.  For
example:<br>
gnetlist -g spice-sdb -o amplifier.cir amplifier.sch<br>
takes the design schematic called "amplifier.sch" and outputs a SPICE
netlist named "amplifier.cir".
</li>

<li>
Inspect your SPICE netlist using a text editor.
Verify that there are no missing attributes or other netlist
problems.
</li>
</ul>

<h2>Common netlisting problems</h2>

<p>It is important to manually inspect your SPICE netlist prior
to using it in simulation.
Please
remember that the netlister is still &quot;alpha&quot; quality, and some problems may
still exist in netlist generation.
The following list attempts to catalog common problems with the netlist and the
associated fixes.</p>

<ul>
<li>ERROR_INVALID_PIN: This can happen if the symbol’s PINSEQ
attributes don’t start at 1, or have gaps in the numbering.
This must be fixed by editing the
symbol itself in a text editor.
</li>
</ul>

<h1>SPICE simulation</h1>

<p>There are at least two ways to perform SPICE simulation
under Linux:</p>

<ul>
<li>LTSpice, which is a freeware SPICE simulator originally released by Linear
Technologies as a component selection/design tool running under windows.
Because its SPICE engine is very fast
and powerful, it has become a popular SPICE simulator amongst hobbyists
and design engineers who prefer to use free tools.  LTSpice has been tweaked to run under 
Linux using wine.</li>

<li>Ngspice, which is a component of the gEDA distribution.
Ngspice is still in its infancy.</li>

</ul>

<H2>LTSpice</H2>

<p>
LTSpice was written by Mike Englehardt at Linear Technologies, and was
originally given away by LinearTech as a design aid for engineers wishing to
simulate the performance of LT's switch mode power supply
controllers.  The package incorporates a schematic capture front end,
fast and powerful SPICE engine, and the capability for plotting the
results of many different types of SPICE analysis.
</p>

<p>
LTSpice was originally developed to run under windows, but Mike has
tweaked it so that it runs fairly well on Linux under wine.
Therefore, it is a great SPICE simulation and analysis back end for
gEDA.
</p>

<h3>Installation and configuration of LTSpice</h3>
To install and configure LTSpice, do the following:
<ol>
<li>Download and install wine.  I have had success using
Wine-20030219.</li>

<li>Download LTSpice.  It is available under
http://www.linear.com/software under the name SwitcherCAD-III.</li>

<li>Run the LTSpice installer under wine.</li>
</ol>

<h3>Running LTSpice with gEDA designs</h3>
LTSpice can read a file holding a gEDA SPICE netlist.  I have had
success doing LTSpice sumulations in the following way:
<ol>
<li>
First of all, make sure that you are logged in as a normal user --
Wine doesn't like to run when invoked by root.  
</li>

<li>Create a file in your project directory called "Simulation.cmd".
In this file place your spice analysis commands (e.g. .OP, .AC, .DC,
etc.)  
</li>

<li>Place a SPICE include block into your schematic.  For the file
attribute, type in "Simulation.cmd".
</li>

<li>Netlist your design.</li>

<li>Create a link from your netlist "output.net" and a netlist in the
directory in which SwCADIII lives.  Make the netlist suffix .cir.  For example:
ln -s ${DESIGN_HOME}/output.net ${WINE_HOME}/.wine/fake_windows/Program Files/LTC/SwCADIII/MyDesign.cir
</li>

<li>Run LTSpice:  cd into the directory where SwCADIII lives and say "wine scad3.exe"</li>

<li>From the SwCADIII GUI, do: File -> Open -> (files of type netlist
[.cir]), and select your file.</li>

<li>Run the simulator by clicking on the run button, or doing:
Simulate -> Run.</li>

<li>Select the variables to graph, and then click OK.  SwCADIII does
the rest of the work.</li>

</ol>

Naturally, it is very important to play around with SwCADIII to
understand how to use it effectively, but the above description should 
suffice to get you started.

<H2>ngspice</H2>

<p>More work is needed in this section. . . . . </p>

<h1>Appendix</h1>

<h2>Component attribute summary</h2>

<p>Native components and their attributes are given in the table
below.  <b>Bold faced</b> attributes are
<b>required</b>, normal typeface attributes are optional.
Note that the &quot;device&quot; attribute is
invisible, and is normally attached to the symbol when it is created.
The other attributes are attached to the
symbol during schematic capture using gschem.</p>

<table border=2>
 <thead>
  <tr>
   <td width=94 valign=top>
     &quot;device&quot;
   </td>
   <td width=74 valign=top >
     &quot;refdes&quot;
   </td>
   <td width=96 valign=top>
     &quot;value&quot;
   </td>
   <td width=94 valign=top>
     &quot;model&quot;
   </td>
   <td width=94 valign=top>
     &quot;file&quot;
   </td>
   <td width=111 valign=top>
     &quot;model-name&quot;
   </td>
   <td width=72 valign=top>
     &quot;type&quot;
   </td>
   <td width=102 valign=top>
     Comment
   </td>
  </tr>
 </thead>
<!------  Next  row: Resistors  ---------->
 <tr>
  <td width=94 valign=top>
    RESISTOR
  </td>
  <td width=74 valign=top>
    R?
  </td>
  <td width=96 valign=top>
    Numeric comp. value
  </td>
  <td width=94 valign=top>
    One line of spice model parameters (e.g. TC)
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    &quot;model&quot; parameters are placed inside parentheses
  after the component value.
  </td>
 </tr>  
<!------  Next  row: Caps  ---------->
 <tr>
  <td width=94 valign=top>
    CAPACITOR
  </td>
  <td width=74 valign=top>
    C?
  </td>
  <td width=96 valign=top>
    Numeric comp. value
  </td>
  <td width=94 valign=top>
    One line of spice model parameters (e.g. IC, POLY, etc.)
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    &quot;model&quot; parameters are placed inside parentheses
  after the component value.
  </td>
 </tr>  

<!------  Next  row: Polarized caps  ---------->
 <tr>
  <td width=94 valign=top>
    POLARIZED_CAPACITOR
  </td>
  <td width=74 valign=top>
    C?
  </td>
  <td width=96 valign=top>
    Numeric comp. value
  </td>
  <td width=94 valign=top>
    One line of spice model parameters (e.g. IC, POLY, etc.)
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    &quot;model&quot; parameters are placed inside parentheses
  after the component value.
  </td>
 </tr>  


<!------  Next  row: Inductors  ---------->
 <tr>
  <td width=94 valign=top>
    INDUCTOR
  </td>
  <td width=74 valign=top>
    L?
  </td>
  <td width=96 valign=top>
    Numeric comp. value
  </td>
  <td width=94 valign=top>
    One line of spice model parameters (e.g. IC, POLY, etc.)
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    &quot;model&quot; parameters are placed inside parentheses
  after the component value.
  </td>
 </tr>  


<!------  Next  row: SPICE-ccvs  ---------->
 <tr>
  <td width=94 valign=top>
    SPICE-ccvs
  </td>
  <td width=74 valign=top>
    H?
  </td>
  <td width=96 valign=top>
    String describing source behavior
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    &nbsp;
  </td>
 </tr>  


<!------  Next  row: SPICE-cccs  ---------->
 <tr>
  <td width=94 valign=top>
    SPICE-cccs
  </td>
  <td width=74 valign=top>
    F?
  </td>
  <td width=96 valign=top>
    String describing source behavior
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    &nbsp;
  </td>
 </tr>  


<!------  Next  row: SPICE-vcvs  ---------->
 <tr>
  <td width=94 valign=top>
    SPICE-vcvs
  </td>
  <td width=74 valign=top>
    E?
  </td>
  <td width=96 valign=top>
    String describing source behavior
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    &nbsp;
  </td>
 </tr>  


<!------  Next  row: SPICE-vccs  ---------->
 <tr>
  <td width=94 valign=top>
    SPICE-vccs
  </td>
  <td width=74 valign=top>
    G?
  </td>
  <td width=96 valign=top>
    String describing source behavior
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    &nbsp;
  </td>
 </tr>  


<!------  Next  row: SPICE-nullor  ---------->
 <tr>
  <td width=94 valign=top>
    SPICE-nullor
  </td>
  <td width=74 valign=top>
    E?
  </td>
  <td width=96 valign=top>
    String describing source behavior
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    &nbsp;
  </td>
 </tr>  


<!------  Next  row: diode  ---------->
 <tr>
  <td width=94 valign=top>
    DIODE
  </td>
  <td width=74 valign=top>
    D?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    One line SPICE model.
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  

<!------  Next  row: PMOS_TRANSISTOR  ---------->
 <tr>
  <td width=94 valign=top>
    PMOS_TRANSISTOR
  </td>
  <td width=74 valign=top>
    M?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    One line SPICE model.
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  


<!------  Next  row: NMOS_TRANSISTOR  ---------->
 <tr>
  <td width=94 valign=top>
    NMOS_TRANSISTOR
  </td>
  <td width=74 valign=top>
    M?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    One line SPICE model.
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  


<!------  Next  row: PNP_TRANSISTOR  ---------->
 <tr>
  <td width=94 valign=top>
    PNP_TRANSISTOR
  </td>
  <td width=74 valign=top>
    Q?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    One line SPICE model.
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  


<!------  Next  row: NPN_TRANSISTOR  ---------->
 <tr>
  <td width=94 valign=top>
    NPN_TRANSISTOR
  </td>
  <td width=74 valign=top>
    Q?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    One line SPICE model.
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  


<!------  Next  row: PFET_TRANSISTOR  ---------->
 <tr>
  <td width=94 valign=top>
    PFET_TRANSISTOR<br><br>(JFET)
  </td>
  <td width=74 valign=top>
    J?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    One line SPICE model.
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  


<!------  Next  row: NFET_TRANSISTOR  ---------->
 <tr>
  <td width=94 valign=top>
    NFET_TRANSISTOR<br><br>(JFET)
  </td>
  <td width=74 valign=top>
    J?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    One line SPICE model.
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  


<!------  Next  row: MESFET_TRANSISTOR  ---------->
 <tr>
  <td width=94 valign=top>
    MESFET_TRANSISTOR
  </td>
  <td width=74 valign=top>
    B?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    One line SPICE model.
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  



<!------  Next  row: MESFET_TRANSISTOR  ---------->
 <tr>
  <td width=94 valign=top>
    IC
  </td>
  <td width=74 valign=top>
    U?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    One line SPICE model.
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    IC with .MODEL file
  </td>
 </tr>  



<!------  Next  row: ic with .SUBCKT  ---------->
 <tr>
  <td width=94 valign=top>
    IC
  </td>
  <td width=74 valign=top>
    X?
  </td>
  <td width=96 valign=top>
    Part number
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model.
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    IC with .SUBCKT file
  </td>
 </tr>  



<!------  Next  row: spice model block  ---------->
 <tr>
  <td width=94 valign=top>
    model
  </td>
  <td width=74 valign=top>
    A?
  </td>
  <td width=96 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
    One line spice model
  </td>
  <td width=94 valign=top>
     Model file name.
  </td>
  <td width=111 valign=top>
    Name of model pointed to by other components.
  </td>
  <td width=72 valign=top>
    Corresponding SPICE model type (valid types given below).
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  

<!------  Next  row: spice include block  ---------->
 <tr>
  <td width=94 valign=top>
    include
  </td>
  <td width=74 valign=top>
    A?
  </td>
  <td width=96 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
     Include file name.
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    Places .INCLUDE directive in SPICE netlist.
  </td>
 </tr>  

<!------  Next  row: spice options block  ---------->
 <tr>
  <td width=94 valign=top>
    options
  </td>
  <td width=74 valign=top>
    A?
  </td>
  <td width=96 valign=top>
    Options to include.
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
     &nbsp;
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    Places .OPTIONS directive in SPICE netlist.
  </td>
 </tr>  

<!------  Next  row:  spice directive block ---------->
 <tr>
  <td width=94 valign=top>
    directive
  </td>
  <td width=74 valign=top>
    A?
  </td>
  <td width=96 valign=top>
    One line string holding SPICE statements for inclusion in netlist.
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    For modeling, one must include either &quot;model&quot; or &quot;file&quot;.
  </td>
 </tr>  


<!------  Next  row:  independent voltage source ---------->
 <tr>
  <td width=94 valign=top>
    VOLTAGE_SOURCE
  </td>
  <td width=74 valign=top>
    V?
  </td>
  <td width=96 valign=top>
    One line string holding voltage source behavior.
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    Independent voltage source
  </td>
 </tr>  


<!------  Next  row:  independent current source  ---------->
 <tr>
  <td width=94 valign=top>
    CURRENT_SOURCE
  </td>
  <td width=74 valign=top>
    V?
  </td>
  <td width=96 valign=top>
    One line string holding current source behavior.
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=94 valign=top>
    &nbsp;
  </td>
  <td width=111 valign=top>
    &nbsp;
  </td>
  <td width=72 valign=top>
    &nbsp;
  </td>
  <td width=102 valign=top>
    Independent current source
  </td>
 </tr>  

</table>

<p>&quot;Native to the netlister&quot; means that there is a
corresponding blob of scheme code which knows exactly how to handle these
components and is guaranteed (almost) to generate correct spice code.
Symbols having &quot;device&quot; attributes
not on the above list are handled using the scheme function
&quot;spice-sdb:write-default-component&quot;, which looks at the refdes of the component
to make a decision about how to treat the component.  
In general, this function will &quot;do the right thing&quot; when
generating spice code, but it is not guaranteed.  In particular, 
this function cannot distinguish between N and P type transistors, and will
generate an &lt;unknown&gt; type for the .MODEL string in the netlist.  
This will probably cause your SPICE 
simulator to barf.
Therefore, it is best to make sure that all devices used have the
proper &quot;device&quot; attribute.</p>

<h2>Valid &quot;type&quot; values</h2>

<p>The &quot;type&quot; attribute is a flag signaling the spice engine
the component type, and prepares it to accept model parameters specific to that
component type.
The following values
are valid SPICE &quot;type&quot;s:</p>

<table border=2>
 <thead>
  <tr>
   <td>
     Component
   </td>
   <td>
     &quot;type&quot;
   </td>
   <td>
    Comment
   </td>
  </tr>
 </thead>
<!------  Next row: Resistsor  -------->
 <tr>
  <td>
    RESISTOR
  </td>
  <td>
    RES
  </td>
  <td>
    &nbsp;
  </td>
 </tr>

<!------  Next row: Capacitor  -------->
 <tr>
  <td>
    CAPACITOR
  </td>
  <td>
    CAP
  </td>
  <td>
    &nbsp;
  </td>
 </tr>

<!------  Next row: Polarized_cap  -------->
 <tr>
  <td>
    POLARIZED_CAPACITOR
  </td>
  <td>
    CAP
  </td>
  <td>
    &nbsp;
  </td>
 </tr>

<!------  Next row: Inductor  -------->
 <tr>
  <td>
    INDUCTOR
  </td>
  <td>
    IND
  </td>
  <td>
    &nbsp;
  </td>
 </tr>

<!------  Next row: Diode  -------->
 <tr>
  <td>
    DIODE
  </td>
  <td>
    D
  </td>
  <td>
    &nbsp;
  </td>
 </tr>


<!------  Next row: PMOS  -------->
 <tr>
  <td>
    PMOS_TRANSISTOR
  </td>
  <td>
    PMOS
  </td>
  <td>
    &nbsp;
  </td>
 </tr>


<!------  Next row: NMOS  -------->
 <tr>
  <td>
    NMOS_TRANSISTOR
  </td>
  <td>
    NMOS
  </td>
  <td>
    &nbsp;
  </td>
 </tr>


<!------  Next row: PNP bipolar  -------->
 <tr>
  <td>
    PNP_TRANSISTOR
  </td>
  <td>
    PNP
  </td>
  <td>
    &nbsp;
  </td>
 </tr>


<!------  Next row: NPN bipolar  -------->
 <tr>
  <td>
    NPN_TRANSISTOR
  </td>
  <td>
    NPN
  </td>
  <td>
    &nbsp;
  </td>
 </tr>


<!------  Next row: PFET  -------->
 <tr>
  <td>
    PFET_TRANSISTOR
  </td>
  <td>
    PJF
  </td>
  <td>
    &nbsp;
  </td>
 </tr>


<!------  Next row: NFET  -------->
 <tr>
  <td>
    NFET_TRANSISTOR
  </td>
  <td>
    NJF
  </td>
  <td>
    &nbsp;
  </td>
 </tr>


<!------  Next row: MESFET  -------->
 <tr>
  <td>
    MESFET_TRANSISTOR
  </td>
  <td>
    &nbsp;
  </td>
  <td>
    &nbsp;
  </td>
 </tr>








</table>


</body>

</html>
