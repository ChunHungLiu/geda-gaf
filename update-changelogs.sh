#!/bin/bash
#
# ./update-changelogs.sh <options>
# Updates ChangeLog files.
#
# e.g. if the main gEDA branch is called master, then to update all
# ChangeLogs with revisions since the switch to git, do:
#
# ./update-changelogs.sh 1.0-20070526..master
#
# This should be only be run while preparing a release, in order to
# ensure that the released tarballs contain change logs which can be
# viewed without access to the git repository.
#
#

if [ "$1" == "" ]
then 
    echo "usage: ./update-changelogs.sh 1.0-20070526..master"
    echo " or"
    echo "usage: ./update-changelogs.sh 1.0-20070526..BRANCH_NAME"
    exit 1
fi

GCLHEADER="# Do not edit this file - generated from version control history"
GCLFOOTER="#GCL#"

if ! git-log -n1 > /dev/null; then
    exit $?
fi

for cl in $(find . -name ChangeLog); do
    echo "Updating ${cl}"
    dir=$(dirname $cl)
    if tail -n1 ${cl} | grep $GCLFOOTER > /dev/null; then
        echo -e "$GCLHEADER\n\n" > $cl
        git-log --pretty=medium $@ -- $dir >> $cl
        echo -e "\n\n$GCLFOOTER" >> $cl
    else
        echo "${cl}: Doesn't appear to be git format log, skipping"
    fi
done
